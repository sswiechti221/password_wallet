import pytest
from password_wallet.encryptions.src import des
from password_wallet.encryptions import utils

@pytest.mark.parametrize("data, expected", [
    (0b0000000100000010000001000000100000010000001000000100000010000000, 0b0100000000010000000001000000000110000000001000000000100000000010)
])
def test_IP(data: int, expected):  
    assert des._IP(utils.BitSet(data, 64)).value == expected

@pytest.mark.parametrize("data, expected", [
    (0b10001011101000000001101100001001, 0b110001010111110100000000000011110110100001010011)
])
def test_E(data: int, expected):
    assert des._E(utils.BitSet(data, 32)).value == expected

@pytest.mark.parametrize("data, expected", [
    (0b1001100100100110001000011111100110010010001000001111011001011010, 0b01011001110010000110111011011101001001000010100010011001),
    (0b0000010001001001111100111101000111110010001111000001101000011111, 0b00011100000111100011010011111101010010100001111000101100),
    (0b1011001100110001110101111110010011001100011011100101101010010110, 0b10011101011111000010101111001110010110111100011100000111)
])
def test_PC_1(data: int, expected: int):    
    left, right = des._PC_1(utils.BitSet(data, 64))
    assert left.expand(right, "Right").value == expected

@pytest.mark.parametrize("data, expected", [
    (0b01011011100111010001101011001001010101010000110100110011, 0b100001000010101111110111010001011101000110100111),
    (0b01101100011001011110111111110011011010101110101010010101, 0b111101110111110010101001111110000100011110010001),
    (0b01011111011111001110000011000001010100100000010010100010, 0b111001000101011111010011000001001000011010100101)
])
def test_PC_2(data: int, expected):
    assert des._PC_2(utils.BitSet(data, 56)) == expected

def test_P():
    assert des._P(utils.BitSet(0b10111000111100001100110001010101, 32)).value == 0b00010111100111010000101100101110

    
def test_F_funciont():
    assert des._F_function(utils.BitSet(0b11001100101010101111000010101010, 32),
                           utils.BitSet(0b111000111100110111100000001111001100111111001100, 48)).value == 0b11110010101011011011011000001110

TEST_VECTORS = [
    (0, 0b000000, 0b1110),
    (0, 0b000001, 0b0000),
    (0, 0b111111, 0b1101),
    (0, 0b100000, 0b0100),
    (0, 0b011111, 0b1000),
    (0, 0b110001, 0b0101),
    (0, 0b110101, 0b0011),
    (0, 0b000101, 0b0111),

    (1, 0b000000, 0b1111),
    (1, 0b000001, 0b0011),
    (1, 0b111111, 0b1001),
    (1, 0b100000, 0b0000),
    (1, 0b011111, 0b0101),
    (1, 0b100001, 0b1101),
    (1, 0b111110, 0b1111),
    (1, 0b110011, 0b0110),

    (2, 0b000000, 0b1010),
    (2, 0b000001, 0b1101),
    (2, 0b111111, 0b1100),
    (2, 0b100000, 0b1101),
    (2, 0b011111, 0b0001),
    (2, 0b001010, 0b0011),
    (2, 0b001111, 0b1010),
    (2, 0b001100, 0b1111),

    (3, 0b000000, 0b0111),
    (3, 0b000001, 0b1101),
    (3, 0b111111, 0b1110),
    (3, 0b100000, 0b1010),
    (3, 0b011111, 0b1001),
    (3, 0b001111, 0b0011),
    (3, 0b010110, 0b0101),
    (3, 0b000100, 0b1110),

    (4, 0b000000, 0b0010),
    (4, 0b000001, 0b1110),
    (4, 0b111111, 0b0011),
    (4, 0b100000, 0b0100),
    (4, 0b011111, 0b0110),
    (4, 0b001010, 0b1010),
    (4, 0b011001, 0b0011),
    (4, 0b101011, 0b1110),

    (5, 0b000000, 0b1100),
    (5, 0b000001, 0b1010),
    (5, 0b111111, 0b1101),
    (5, 0b100000, 0b1001),
    (5, 0b011111, 0b1000),
    (5, 0b001100, 0b0110),
    (5, 0b011001, 0b0000),
    (5, 0b111001, 0b0110),

    (6, 0b000000, 0b0100),
    (6, 0b000001, 0b1101),
    (6, 0b111111, 0b1100),
    (6, 0b100000, 0b0001),
    (6, 0b011111, 0b0110),
    (6, 0b001001, 0b0100),
    (6, 0b101010, 0b0011),
    (6, 0b111100, 0b1001),

    (7, 0b000000, 0b1101),
    (7, 0b000001, 0b0001),
    (7, 0b111111, 0b1011),
    (7, 0b100000, 0b0111),
    (7, 0b011111, 0b0010),
    (7, 0b001100, 0b1011),
    (7, 0b101101, 0b1000),
    (7, 0b110111, 0b0000),
]

@pytest.mark.parametrize("sbox, value, expected", TEST_VECTORS)
def test_S_BOX(sbox, value, expected):
    assert des._S_BOX(sbox, utils.BitSet(value, 6)).value == expected